<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VaxitUp</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    
    <link rel="stylesheet" href="{% static 'css/footer.css' %}">
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
   <style>
    html, body {
        height: 100%;
        margin: 0;
        display: flex;
        flex-direction: column;
    }
    
    body {
        padding-top: 90px; /* Adjust based on header height */
        transition: padding-top 0.3s ease-in-out;
    }
    
    .container {
        flex: 1;  /* Allows content to expand and push footer down */
        min-height: 70vh; /* Ensures content area has enough height */
        padding-bottom: 20px; /* Add some spacing */
    }     
</style>    
</head>
<body>
     <!-- Responsive Header -->
<header>
        <div class="logo">
           <img src="{% static './images/logo2.png' %}" alt="Logo">
           <h2 style="color: white;">VaxItUp</h2> 
        </div>
    
        <!-- Hamburger Menu (only visible in mobile view) -->
        <div class="menu-toggle" onclick="toggleMenu()">
            <div></div>
            <div></div>
            <div></div>
        </div>
    
        <nav id="navbar">
            <ul>
                <li><a href="{% url 'homeuser' %}">Home</a></li>
                <li><a href="{% url 'feedback_view' %}">Feedback</a></li>
                <li><a href="{% url 'USERProfile' %}">Profile</a></li>
                <li class="notification-container">
                    <a href="#" id="notification-link">
                        Notifications <span id="notification-badge" class="badge" style="display: none;">0</span> 
                    </a>
                    <div id="notification-dropdown" class="notification-dropdown">
                        <ul id="notification-list">
                            <li>Loading notifications...</li> <!-- Placeholder -->
                        </ul>
                        <a href="{% url 'user_notifications' %}" id="view-all-notifications">View All</a>
                    </div>
                </li>                                                         
            </ul>
        </nav>
    
        <!-- Logout button (visible outside hamburger menu) -->
        <div class="buttons">
            <button class="LogOut">
                <a style="color: white; text-decoration: none;" href="{% url 'user_logout' %}">LogOut</a>
            </button>                       
        </div>
</header>
<div class="content-wrapper">
    {% block content %}
    {% endblock %}
</div>
 <!-- Footer Section -->
 <footer>
    <div class="footer-container">
        <!-- Contact Information -->
        <div class="footer-section">
            <h3>Contact Us</h3>
            <p><i class="fas fa-envelope"></i> Email: <a href="mailto:support@vaccinebooking.com">support@vaccinebooking.com</a></p>
            <p><i class="fas fa-phone"></i> Phone: <a href="tel:+911234567890">+91 12345 67890</a></p>
            <p><i class="fas fa-map-marker-alt"></i> Address: 123 Health St., City, Country</p>
        </div>

        <!-- Quick Links -->
        <div class="footer-section">
            <h3>Quick Links</h3>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#steps">How It Works</a></li>
                <li><a href="#contact">Contact</a></li>
                <li><a href="#faq">FAQ</a></li>
            </ul>
        </div>

        <!-- Follow Us -->
        <div class="footer-section">
            <h3>Follow Us</h3>
            <ul class="social-links">
                <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
                <li><a href="#"><i class="fab fa-twitter"></i></a></li>
                <li><a href="#"><i class="fab fa-instagram"></i></a></li>
            </ul>
        </div>
    </div>
</footer>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const notificationLink = document.getElementById("notification-link");
        const notificationDropdown = document.getElementById("notification-dropdown");
        const notificationBadge = document.getElementById("notification-badge");
    
        let hasUnread = false; // Track unread messages
    
        // Toggle notification dropdown
        notificationLink.addEventListener("click", function (event) {
            event.preventDefault();
            notificationDropdown.classList.toggle("active");
    
            // Mark notifications as read when dropdown is opened
            if (notificationDropdown.classList.contains("active")) {
                fetchNotifications(true); // Pass `true` to mark as read
            }
        });
    
        // Close dropdown when clicking outside
        document.addEventListener("click", function (event) {
            if (!event.target.closest(".notification-container")) {
                notificationDropdown.classList.remove("active");
            }
        });
    
        function fetchNotifications(markAsRead = false) {
            fetch("{% url 'user_notifications_json' %}") // Fetch JSON data from Django view
                .then(response => response.json())
                .then(data => {
                    const notificationList = document.getElementById("notification-list");
                    notificationList.innerHTML = ""; // Clear old notifications
        
                    if (data.notifications.length === 0) {
                        notificationList.innerHTML = "<li>No new notifications</li>";
                        notificationBadge.style.display = "none"; // Hide badge
                    } else {
                        notificationBadge.textContent = data.unread_count; // Update count with unread messages
                        notificationBadge.style.display = data.unread_count > 0 ? "inline-block" : "none"; // Show/hide badge
        
                        // Show only the latest notification
                        const latestNotification = data.notifications[0];
        
                        const listItem = document.createElement("li");
                        listItem.innerHTML = `<strong>${latestNotification.center_name}:</strong> ${latestNotification.message}`;
        
                        if (latestNotification.document_url) {
                            const docLink = document.createElement("a");
                            docLink.href = latestNotification.document_url;
                            docLink.textContent = " View Document";
                            docLink.target = "_blank";
                            listItem.appendChild(docLink);
                        }
        
                        notificationList.appendChild(listItem);
        
                        // Mark as read if dropdown is opened
                        if (markAsRead) {
                            markNotificationsAsRead();
                        }
                    }
                })
                .catch(error => {
                    console.error("Error fetching notifications:", error);
                });
        }
        function markNotificationsAsRead() {
            notificationBadge.style.display = "none"; // Hide badge after opening dropdown
            hasUnread = false; // Reset unread flag
        }
    
        // Auto-check for new notifications every 10 seconds
        setInterval(fetchNotifications, 10000);
    });
      
    let lastScrollTop = 0;
    const header = document.querySelector("header");
    
    window.addEventListener("scroll", function () {
        let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    
        if (scrollTop > lastScrollTop) {
            // Scrolling Down - Hide Header
            header.style.transform = "translateY(-100%)";
        } else {
            // Scrolling Up - Show Header
            header.style.transform = "translateY(0)";
        }
    
        lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
    });
    

</script>

</body>
</html>