{% extends "master.html" %} 
{% block content %} 
{% load static %}

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Booking Confirmation</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    .progress-step {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: #e0e0e0;
      color: #6c757d;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .progress-step.active {
      background: #4F46E5;
      color: white;
    }
    .progress-line {
      flex-grow: 1;
      height: 4px;
      background: #e0e0e0;
      margin: 0 10px;
    }
    .progress-line.active {
      background: #4F46E5;
    }
    .time-slot {
      padding: 10px 15px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
      display: inline-block;
      text-align: center;
    }
    .time-slot.available {
      background-color: #28a745;
      color: white;
    }
    .time-slot.booked {
      background-color: #dc3545;
      color: white;
      cursor: not-allowed;
    }
    .modal-content {
      position: relative;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      cursor: pointer;
      color: #000;
    }
  </style>
</head>

<body class="bg-light">
  <div class="container py-5">
    <div class="row g-4 bg-white shadow rounded overflow-hidden p-4">
      <div class="col-md-7">
        <h1 class="fw-bold">Booking Confirmation</h1>
        <p class="text-muted">Please fill in your details to complete the booking</p>

        <div class="d-flex align-items-center mb-4">
          <div class="progress-step active">1</div>
          <div class="progress-line active"></div>
          <div class="progress-step">2</div>
          <div class="progress-line"></div>
          <div class="progress-step">3</div>
        </div>
        <form id="bookingForm" method="post">
          {% csrf_token %}
          {% if errors.general %}
              <div class="alert alert-danger">{{ errors.general }}</div>
          {% endif %}

          <h4 class="fw-semibold">Personal Information</h4>
          <div class="row mb-3">
            <div class="col-md-5">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" name="name" value="{{ form_data.name|default:'' }}" required>
              {% if errors.name %}
                  <div class="text-danger mt-1">{{ errors.name }}</div>
              {% endif %}
          </div>          
          <div class="col-md-5">
            <label class="form-label">Age</label>
            <input type="number" class="form-control" name="age" value="{{ form_data.age|default:'' }}" required>
            {% if errors.age %}
                <div class="text-danger mt-1">{{ errors.age }}</div>
            {% endif %}
        </div>        
          </div>
      
          <div class="mb-3">
            <label class="form-label">Email Address</label>
            <input type="email" class="form-control" name="email" value="{{ form_data.email|default:'' }}" required>
            {% if errors.email %}
                <div class="text-danger mt-1">{{ errors.email }}</div>
            {% endif %}
        </div>
        
      
        <div class="mb-3">
          <label class="form-label">Phone Number</label>
          <input type="tel" class="form-control" name="phone" value="{{ form_data.phone|default:'' }}" required>
          {% if errors.phone %}
              <div class="text-danger mt-1">{{ errors.phone }}</div>
          {% endif %}
      </div>
      
      <div class="mb-3">
        <label class="form-label">Aadhaar Number</label>
        <input type="text" class="form-control" name="aadhaar" value="{{ form_data.aadhaar|default:'' }}" 
               pattern="\d{12}" maxlength="12" minlength="12" required
               oninvalid="this.setCustomValidity('Please enter a valid 12-digit Aadhaar number')"
               oninput="this.setCustomValidity('')">
        {% if errors.aadhaar %}
            <div class="text-danger mt-1">{{ errors.aadhaar }}</div>
        {% endif %}
    </div>
    

          <h4 class="fw-semibold">Booking Details</h4>
          <div class="mb-3">
              <label class="form-label">Selected Vaccine</label>
              <input type="text" id="selectedVaccine" class="form-control" name="vaccine" value="{{ selected_vaccine }}" readonly>
          </div>
          <div class="mb-3">
              <label class="form-label">Vaccine Center</label>
              <input type="text" id="selectedCenter" class="form-control" name="center" value="{{ selected_center }}" readonly>
          </div>
      
          <div class="mb-3">
            <label class="form-label d-block">Dose for Applying</label>
            <div id="doseSelection">
                {% for i in "1234" %}
                    <div class="form-check form-check-inline dose-option" data-dose="{{ i }}">
                        <input class="form-check-input" type="radio" name="doses" value="{{ i }}" {% if form_data.dose == i %}checked{% endif %} required>
                        <label class="form-check-label">Dose {{ i }}</label>
                    </div>
                {% endfor %}
            </div>
            {% if errors.dose %}
                <div class="text-danger mt-1">{{ errors.dose }}</div>
            {% endif %}
        </div>
        
      
          <h4 class="fw-semibold">Schedule</h4>
          <div class="row mb-3">
            <div class="col-md-5">
              <label class="form-label">Date</label>
              <input type="date" id="selectedDate" class="form-control" name="date" value="{{ form_data.date|default:'' }}" required>
              {% if errors.date %}
                  <div class="text-danger mt-1">{{ errors.date }}</div>
              {% endif %}
          </div>
          
          <div class="col-md-5">
            <label class="form-label">Time</label>
            <input type="text" id="selectedTimeInput" class="form-control" name="time" value="{{ form_data.time|default:'' }}" placeholder="Click to select time" readonly onclick="openTimePopup()">
            {% if errors.time %}
                <div class="text-danger mt-1">{{ errors.time }}</div>
            {% endif %}
        </div>        
          </div>
      
          <div class="d-flex justify-content-between mt-4">
              <a href="{% url 'homeuser' %}" class="btn btn-danger">Cancel</a>
              <button type="submit" class="btn btn-primary">Confirm Booking</button>
          </div>
      </form>             
      </div>

      <div class="col-md-4 position-relative">
        <img src="https://i.pinimg.com/736x/56/86/91/568691dff91597e5a16a53acb3b714dd.jpg" class="img-fluid rounded" alt="Booking Image">
        <div class="position-absolute top-50 start-50 translate-middle text-center text-white" style="background: rgba(0, 0, 0, 0.4); padding: 20px; border-radius: 10px;">
            <h3 class="fw-bold">Stay Safe, Get Vaccinated</h3>
            <p>Protect yourself and your loved ones. Book your vaccine appointment today!</p>
        </div>
    </div>
    

    </div>
  </div>

  <!-- Time Selection Popup -->
  <div class="modal fade" id="timePopup" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4">
        <span class="close-btn" onclick="closeTimePopup()">Ã—</span>
        <h4 class="fw-bold text-center">Select a Time Slot</h4>
        <div id="timeSlots" class="text-center my-3">
          <button class="time-slot {% if '09:30 AM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '09:30 AM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '09:30 AM')">09:30 AM</button>
        
          <button class="time-slot {% if '10:00 AM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '10:00 AM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '10:00 AM')">10:00 AM</button>
        
          <button class="time-slot {% if '10:30 AM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '10:30 AM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '10:30 AM')">10:30 AM</button>
        
          <button class="time-slot {% if '11:00 AM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '11:00 AM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '11:00 AM')">11:00 AM</button>
        
          <button class="time-slot {% if '11:30 AM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '11:30 AM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '11:30 AM')">11:30 AM</button>
        
          <button class="time-slot {% if '12:00 PM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '12:00 PM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '12:00 PM')">12:00 PM</button>
        
          <button class="time-slot {% if '12:30 PM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '12:30 PM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '12:30 PM')">12:30 PM</button>
        
          <button class="time-slot {% if '01:00 PM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '01:00 PM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '01:00 PM')">01:00 PM</button>
        
          <div class="text-danger fw-bold my-2">Lunch Break (1:30 PM - 2:00 PM)</div>
        
          <button class="time-slot {% if '02:00 PM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '02:00 PM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '02:00 PM')">02:00 PM</button>
        
          <button class="time-slot {% if '02:30 PM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '02:30 PM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '02:30 PM')">02:30 PM</button>
        
          <button class="time-slot {% if '03:00 PM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '03:00 PM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '03:00 PM')">03:00 PM</button>
        
          <button class="time-slot {% if '03:30 PM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '03:30 PM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '03:30 PM')">03:30 PM</button>
        
          <button class="time-slot {% if '04:00 PM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '04:00 PM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '04:00 PM')">04:00 PM</button>
        
          <button class="time-slot {% if '04:30 PM' in booked_times %}btn-danger booked{% else %}btn-success available{% endif %}" 
                  {% if '04:30 PM' in booked_times %}disabled{% endif %}
                  onclick="selectTimeSlot(this, '04:30 PM')">04:30 PM</button>
        </div>        
        <button class="btn btn-success w-100 mt-3" onclick="confirmTime()">Confirm Time</button>
      </div>
    </div>
  </div>
    </div>
  </div>
  <!-- Add SweetAlert2 CSS and JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

{% if token_number %}
  <script>
    window.onload = function() {
      Swal.fire({
        title: "Booking Successful!",
        text: "Your token number is: {{ token_number }}",
        icon: "success",
        confirmButtonColor: "#4CAF50",
        confirmButtonText: "OK"
      }).then(() => {
        window.location.href = "{% url 'homeuser' %}"; // Redirect only after clicking OK
      });
    };
  </script>
{% endif %}

  <script>
    function openTimePopup() {
        let timePopup = bootstrap.Modal.getOrCreateInstance(document.getElementById('timePopup'));
        timePopup.show();
    }
  
    function closeTimePopup() {
        let timePopup = bootstrap.Modal.getOrCreateInstance(document.getElementById('timePopup'));
        timePopup.hide();
    }
  
    function selectTimeSlot(button, time) {
        document.getElementById("selectedTimeInput").value = time;
        closeTimePopup();
    }
    
  </script>

</body>
{% endblock %}
